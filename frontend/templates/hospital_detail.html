<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç—…é™¢è©³ç´° - ç—‡çŠ¶ãƒã‚§ãƒƒã‚«ãƒ¼</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <nav class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">ç—‡çŠ¶ãƒã‚§ãƒƒã‚«ãƒ¼</h1>
            <div class="space-x-4">
                <a href="/" class="hover:text-blue-200">ãƒ›ãƒ¼ãƒ </a>
                <a href="/symptom" class="hover:text-blue-200">ç—‡çŠ¶ãƒã‚§ãƒƒã‚¯</a>
                <a href="/hospital" class="hover:text-blue-200">ç—…é™¢æ¤œç´¢</a>
                <a href="/user/register" class="hover:text-blue-200">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²</a>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <div class="mb-4">
                <button onclick="history.back()" class="text-blue-600 hover:text-blue-800">
                    â† æˆ»ã‚‹
                </button>
            </div>
            
            <div id="hospital-detail" class="bg-white rounded-lg shadow-lg p-8">
                <div class="text-center">
                    <div class="loading"></div>
                    <p>ç—…é™¢æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        const hospitalId = "{{.hospitalID}}";
        
        document.addEventListener('DOMContentLoaded', function() {
            loadHospitalDetail();
        });

        function loadHospitalDetail() {
            fetch(`/api/v1/hospitals/${hospitalId}`)
                .then(response => response.json())
                .then(hospital => {
                    displayHospitalDetail(hospital);
                })
                .catch(error => {
                    console.error('ç—…é™¢è©³ç´°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                    document.getElementById('hospital-detail').innerHTML = `
                        <div class="text-center p-8">
                            <div class="text-4xl mb-4">âŒ</div>
                            <h3 class="text-lg font-semibold mb-2">ç—…é™¢æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</h3>
                            <p class="text-gray-600 mb-4">ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚</p>
                            <button onclick="history.back()" class="btn-primary">æˆ»ã‚‹</button>
                        </div>
                    `;
                });
        }

        function displayHospitalDetail(hospital) {
            const distance = hospital.distance ? `${hospital.distance.toFixed(1)}km` : '';
            const rating = hospital.rating ? `â­ ${hospital.rating.toFixed(1)}` : '';
            const emergencyBadge = hospital.emergency ? '<span class="bg-red-100 text-red-800 px-3 py-1 rounded-full">ç·Šæ€¥å¯¾å¿œå¯èƒ½</span>' : '';
            
            const html = `
                <div class="space-y-6">
                    <!-- ç—…é™¢åŸºæœ¬æƒ…å ± -->
                    <div class="text-center border-b pb-6">
                        <h2 class="text-2xl font-bold mb-2">${hospital.name}</h2>
                        <div class="flex justify-center items-center space-x-4 text-sm text-gray-600">
                            ${distance ? `<span class="flex items-center"><span class="text-blue-500 mr-1">ğŸ“</span>${distance}</span>` : ''}
                            ${rating ? `<span class="flex items-center"><span class="text-yellow-500 mr-1">â­</span>${rating}</span>` : ''}
                            ${emergencyBadge}
                        </div>
                    </div>

                    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ãƒœã‚¿ãƒ³ -->
                    <div class="grid md:grid-cols-3 gap-4">
                        <button class="btn-success text-lg py-4" onclick="callHospital('${hospital.phone}')">
                            ğŸ“ é›»è©±ã™ã‚‹
                        </button>
                        <button class="btn-secondary text-lg py-4" onclick="showHospitalMap(${hospital.location.latitude}, ${hospital.location.longitude}, '${hospital.name}')">
                            ğŸ—ºï¸ åœ°å›³ã§è¦‹ã‚‹
                        </button>
                        ${hospital.website ? `<a href="${hospital.website}" target="_blank" class="btn-primary text-lg py-4 text-center">ğŸŒ ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ</a>` : '<div></div>'}
                    </div>

                    <!-- ç—…é™¢è©³ç´°æƒ…å ± -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- åŸºæœ¬æƒ…å ± -->
                        <div class="card">
                            <h3 class="text-lg font-semibold mb-4">åŸºæœ¬æƒ…å ±</h3>
                            <div class="space-y-3">
                                <div>
                                    <strong class="text-gray-700">ä½æ‰€:</strong>
                                    <p class="text-gray-600">${hospital.location.address}</p>
                                </div>
                                <div>
                                    <strong class="text-gray-700">é›»è©±ç•ªå·:</strong>
                                    <p class="text-gray-600">
                                        <a href="tel:${hospital.phone}" class="text-blue-600 hover:underline">
                                            ${hospital.phone}
                                        </a>
                                    </p>
                                </div>
                                ${hospital.website ? `
                                <div>
                                    <strong class="text-gray-700">ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ:</strong>
                                    <p class="text-gray-600">
                                        <a href="${hospital.website}" target="_blank" class="text-blue-600 hover:underline">
                                            ${hospital.website}
                                        </a>
                                    </p>
                                </div>
                                ` : ''}
                            </div>
                        </div>

                        <!-- è¨ºç™‚ç§‘ -->
                        <div class="card">
                            <h3 class="text-lg font-semibold mb-4">è¨ºç™‚ç§‘</h3>
                            <div class="flex flex-wrap gap-2">
                                ${hospital.specialties.map(specialty => 
                                    `<span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">${specialty}</span>`
                                ).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- å–¶æ¥­æ™‚é–“ -->
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-4">å–¶æ¥­æ™‚é–“</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${hospital.hours ? hospital.hours.map(hours => `
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="font-medium">${hours.day}æ›œæ—¥</span>
                                    <span class="${hours.is_closed ? 'text-red-600' : 'text-gray-600'}">
                                        ${hours.is_closed ? 'ä¼‘è¨º' : `${hours.open_time} - ${hours.close_time}`}
                                    </span>
                                </div>
                            `).join('') : '<p class="text-gray-600">å–¶æ¥­æ™‚é–“ã®è©³ç´°ã¯ç—…é™¢ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>'}
                        </div>
                    </div>

                    <!-- åœ°å›³ -->
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-4">ã‚¢ã‚¯ã‚»ã‚¹</h3>
                        <div class="aspect-w-16 aspect-h-9 bg-gray-200 rounded-lg mb-4">
                            <iframe 
                                width="100%" 
                                height="300" 
                                frameborder="0" 
                                style="border:0" 
                                src="https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY&q=${hospital.location.latitude},${hospital.location.longitude}"
                                allowfullscreen>
                            </iframe>
                        </div>
                        <div class="text-center">
                            <button class="btn-secondary" onclick="getDirections(${hospital.location.latitude}, ${hospital.location.longitude})">
                                ğŸ“ ãƒ«ãƒ¼ãƒˆã‚’æ¤œç´¢
                            </button>
                        </div>
                    </div>

                    <!-- æ³¨æ„äº‹é … -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h4 class="font-semibold text-yellow-800 mb-2">ã”æ³¨æ„</h4>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>â€¢ è¨ºç™‚æ™‚é–“ã‚„ä¼‘è¨ºæ—¥ã¯å¤‰æ›´ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚å—è¨ºå‰ã«å¿…ãšãŠé›»è©±ã§ã”ç¢ºèªãã ã•ã„ã€‚</li>
                            <li>â€¢ ç·Šæ€¥æ™‚ã¯119ç•ªé€šå ±ã¾ãŸã¯æœ€å¯„ã‚Šã®æ•‘æ€¥ç—…é™¢ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚</li>
                            <li>â€¢ åˆè¨ºã®å ´åˆã¯ã€å¥åº·ä¿é™ºè¨¼ã‚’ãŠæŒã¡ãã ã•ã„ã€‚</li>
                        </ul>
                    </div>
                </div>
            `;
            
            document.getElementById('hospital-detail').innerHTML = html;
        }

        function callHospital(phoneNumber) {
            if (confirm(`${phoneNumber} ã«é›»è©±ã‚’ã‹ã‘ã¾ã™ã‹ï¼Ÿ`)) {
                window.location.href = `tel:${phoneNumber}`;
            }
        }

        function showHospitalMap(latitude, longitude, hospitalName) {
            const mapUrl = `https://www.google.com/maps/search/?api=1&query=${latitude},${longitude}&query_place_id=${encodeURIComponent(hospitalName)}`;
            window.open(mapUrl, '_blank');
        }

        function getDirections(latitude, longitude) {
            const directionsUrl = `https://www.google.com/maps/dir/?api=1&destination=${latitude},${longitude}`;
            window.open(directionsUrl, '_blank');
        }
    </script>
    
    <script src="/static/js/main.js"></script>
</body>
</html>